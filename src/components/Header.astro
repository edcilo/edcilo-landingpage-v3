---
import Container from './Container.astro';
import ThemeToggle from './ThemeToggle.astro';
import MobileDrawer from './MobileDrawer.astro';

const navLinks = [
	{ href: '#hero', label: 'Home' },
	{ href: '#skills', label: 'Skills' },
	{ href: '#about', label: 'About' },
	{ href: '#projects', label: 'Projects' },
	{ href: '#contact', label: 'Contact' },
];
---

<header
	class="sticky top-0 z-50 w-full border-b border-border bg-background/80 backdrop-blur-lg"
>
	<Container>
		<nav
			class="flex h-16 items-center justify-between font-mono"
			aria-label="Main navigation"
		>
			<a
				href="/"
				class="flex items-center hover:opacity-80 transition-opacity"
				aria-label="edcilo â€” Home"
			>
				<img
					src="/logo.svg"
					alt="edcilo logo"
					class="h-8 w-auto dark:invert"
					width="101"
					height="32"
				/>
			</a>
			<div class="flex items-center gap-1">
				<div class="hidden items-center gap-1 md:flex">
					{
						navLinks.map((link) => (
							<a
								href={link.href}
								data-nav-link={link.href}
								class="nav-link rounded-md px-3 py-2 text-sm font-medium text-muted-foreground hover:text-foreground hover:bg-accent transition-colors"
							>
								{link.label}
							</a>
						))
					}
				</div>
				<ThemeToggle />
				<!-- Mobile menu button -->
				<button
					type="button"
					id="menu-toggle"
					aria-label="Open navigation menu"
					aria-expanded="false"
					aria-controls="drawer-panel"
					class="cursor-pointer rounded-md p-2 text-muted-foreground hover:text-foreground hover:bg-accent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary md:hidden"
				>
					<svg
						xmlns="http://www.w3.org/2000/svg"
						fill="none"
						viewBox="0 0 24 24"
						stroke-width="1.5"
						stroke="currentColor"
						class="size-5"
						aria-hidden="true"
					>
						<path
							stroke-linecap="round"
							stroke-linejoin="round"
							d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path>
					</svg>
				</button>
			</div>
		</nav>
	</Container>
</header>

<MobileDrawer navLinks={navLinks} />

<script>
	function initActiveNav(): void {
		const navLinks =
			document.querySelectorAll<HTMLAnchorElement>('[data-nav-link]');
		const sections = new Map<string, Element>();

		navLinks.forEach((link) => {
			const href = link.getAttribute('data-nav-link');
			if (!href || !href.startsWith('#')) return;
			const section = document.querySelector(href);
			if (section) sections.set(href, section);
		});

		function setActive(hash: string): void {
			navLinks.forEach((link) => {
				const linkHash = link.getAttribute('data-nav-link');
				if (linkHash === hash) {
					link.classList.remove('text-muted-foreground');
					link.classList.add('text-foreground');
				} else {
					link.classList.add('text-muted-foreground');
					link.classList.remove('text-foreground');
				}
			});
		}

		const observer = new IntersectionObserver(
			(entries) => {
				for (const entry of entries) {
					if (entry.isIntersecting) {
						const id = entry.target.getAttribute('id');
						if (id) setActive(`#${id}`);
					}
				}
			},
			{ rootMargin: '-50% 0px -50% 0px' },
		);

		sections.forEach((section) => observer.observe(section));
	}

	initActiveNav();
	document.addEventListener('astro:page-load', initActiveNav);
</script>
