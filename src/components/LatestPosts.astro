---
import { getCollection } from 'astro:content';
import SectionHeading from './SectionHeading.astro';
import BlogPostCard from './BlogPostCard.astro';
import { DEFAULT_LOCALE } from '../i18n/config';
import { useTranslations, getLocalizedPath } from '../i18n/utils';

const locale = Astro.currentLocale ?? DEFAULT_LOCALE;
const t = useTranslations(locale);

const latestPosts = (await getCollection('blog', ({ data }) => !data.draft))
	.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
	.slice(0, 3);
---

{
	latestPosts.length > 0 && (
		<section
			id="blog"
			class="blog-section relative border-t border-dashed border-border py-16 sm:py-24"
			aria-labelledby="latest-posts-heading"
		>
			<svg
				xmlns="http://www.w3.org/2000/svg"
				viewBox="0 0 120 120"
				fill="currentColor"
				class="blog-bg-icon pointer-events-none fixed top-[60%] left-1/2 -translate-x-1/2 -translate-y-1/2 h-[800px] w-[800px] text-foreground opacity-[0.07] dark:opacity-[0.05] lg:top-[70%]"
				aria-hidden="true"
			>
				<path
					d="M229.836,303.736C229.582,303.934 229.418,304.227 229.383,304.548C229.347,304.868 229.443,305.19 229.647,305.439C238.458,316.013 251.723,322.75 266.549,322.75C293.041,322.75 314.549,301.242 314.549,274.75C314.549,272.807 314.433,270.891 314.209,269.008C314.158,268.592 314.329,268.18 314.66,267.922C317.349,265.82 329.419,256.39 333.503,253.199C333.813,252.956 334.223,252.882 334.598,252.999C334.974,253.116 335.268,253.411 335.384,253.787C337.398,260.418 338.482,267.452 338.482,274.738C338.482,314.48 306.217,346.746 266.474,346.746C226.732,346.746 194.467,314.48 194.467,274.738C194.467,234.996 226.732,202.73 266.474,202.73C289.177,202.73 309.44,213.259 322.642,229.696C322.841,229.946 322.931,230.264 322.894,230.581C322.856,230.897 322.694,231.186 322.443,231.382C318.62,234.371 304.515,245.391 304.515,245.391C304.515,245.391 238.6,296.889 229.836,303.736ZM283.131,231.641C283.473,231.374 283.644,230.943 283.578,230.514C283.511,230.085 283.218,229.726 282.811,229.575C277.731,227.748 272.256,226.75 266.549,226.75C240.057,226.75 218.549,248.258 218.549,274.75C218.549,276.382 218.631,277.995 218.79,279.586C218.835,280.019 219.111,280.392 219.512,280.563C219.912,280.733 220.373,280.672 220.715,280.404C229.871,273.253 273.989,238.784 283.131,231.641Z"
					transform="matrix(0.833247,0,0,0.833247,-162.039,-168.924)"
				/>
			</svg>
			<SectionHeading
				id="latest-posts-heading"
				title={t('latestPosts.title')}
				subtitle={t('latestPosts.subtitle')}
			/>

			<div class="grid grid-cols-1 gap-4 md:grid-cols-3 md:gap-6">
				{latestPosts.map((post) => (
					<BlogPostCard
						title={post.data.title}
						description={post.data.description}
						date={post.data.date}
						tags={post.data.tags}
						slug={post.id}
					/>
				))}
			</div>

			<div class="mt-8 text-center">
				<a
					href={getLocalizedPath('/blog', locale)}
					class="inline-flex items-center gap-1 font-mono text-sm text-muted-foreground hover:text-foreground transition-colors"
				>
					{t('latestPosts.viewAll')}
					<svg
						xmlns="http://www.w3.org/2000/svg"
						fill="none"
						viewBox="0 0 24 24"
						stroke-width="1.5"
						stroke="currentColor"
						class="size-4"
						aria-hidden="true"
					>
						<path
							stroke-linecap="round"
							stroke-linejoin="round"
							d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"
						/>
					</svg>
				</a>
			</div>
		</section>
	)
}

<style>
	.blog-section {
		clip-path: inset(0);
	}

	@media (prefers-reduced-motion: reduce) {
		.blog-bg-icon {
			position: absolute;
		}
	}
</style>
