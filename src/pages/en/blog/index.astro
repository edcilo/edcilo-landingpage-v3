---
import { getCollection } from 'astro:content';
import Layout from '../../../layouts/Layout.astro';
import SectionHeading from '../../../components/SectionHeading.astro';
import BlogPostCard from '../../../components/BlogPostCard.astro';
import BlogTagFilter from '../../../components/BlogTagFilter.astro';
import { DEFAULT_LOCALE } from '../../../i18n/config';
import { useTranslations } from '../../../i18n/utils';

const locale = Astro.currentLocale ?? DEFAULT_LOCALE;
const t = useTranslations(locale);

const posts = (await getCollection('blog', ({ data }) => !data.draft)).sort(
	(a, b) => b.data.date.valueOf() - a.data.date.valueOf(),
);

const allTags = [...new Set(posts.flatMap((post) => post.data.tags))].sort();
---

<Layout title={`${t('blog.title')} â€” edcilo`} description={t('blog.subtitle')}>
	<section class="py-16 sm:py-24" aria-labelledby="blog-heading">
		<SectionHeading
			id="blog-heading"
			title={t('blog.title')}
			subtitle={t('blog.subtitle')}
		/>

		{
			allTags.length > 1 && (
				<BlogTagFilter
					tags={allTags}
					filterLabel={t('blog.filter.label')}
					allLabel={t('blog.filter.all')}
					noResultsMessage={t('blog.filter.noResults')}
				/>
			)
		}

		{
			posts.length > 0 ? (
				<div
					data-blog-grid
					class="grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3 md:gap-6"
				>
					{posts.map((post) => (
						<BlogPostCard
							title={post.data.title}
							description={post.data.description}
							date={post.data.date}
							tags={post.data.tags}
							slug={post.id}
						/>
					))}
				</div>
			) : (
				<p class="text-center font-mono text-muted-foreground">
					{t('blog.empty')}
				</p>
			)
		}
	</section>
</Layout>
